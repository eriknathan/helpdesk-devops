{% extends 'base.html' %}{% load badge_tags %}{% block title %}#{{ ticket.pk }} — {{ ticket.title }} — HelpDesk DevOps{% endblock %}{% block content %}<div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8"><nav class="flex mb-6 text-sm" aria-label="Breadcrumb"><ol class="flex items-center space-x-2"><li><a href="/" class="text-gray-500 hover:text-indigo-600 transition-colors duration-200">Dashboard</a></li><li><svg class="h-4 w-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" /></svg></li><li><a href="{% url 'tickets:list' %}" class="text-gray-500 hover:text-indigo-600 transition-colors duration-200">Chamados</a></li><li><svg class="h-4 w-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" /></svg></li><li class="text-gray-900 font-medium">#{{ ticket.pk }}</li></ol></nav><div class="grid grid-cols-1 lg:grid-cols-3 gap-6"><div class="lg:col-span-2 space-y-6"><div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"><div class="px-6 py-4 border-b border-gray-200"><div class="flex items-center space-x-3"><span class="text-gray-400 font-mono text-sm">#{{ ticket.pk }}</span><h1 class="text-lg font-bold text-gray-900">{{ ticket.title }}</h1></div></div><div class="p-6"><div class="flex flex-wrap items-center gap-2 mb-4">{% status_badge ticket.status %}{% priority_badge ticket.priority %}{% if sla.rt_breached %}<span class="px-2.5 py-0.5 text-xs font-medium rounded-full bg-rose-100 text-rose-700">SLA Estourado</span>{% endif %}</div><div class="prose prose-sm max-w-none text-gray-600"><p>{{ ticket.description|linebreaksbr }}</p></div></div></div><div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"><div class="px-6 py-4 border-b border-gray-200"><h2 class="text-lg font-semibold text-gray-900">Comentários ({{ comments|length }})</h2></div><div class="divide-y divide-gray-100">{% for comment in comments %}<div class="px-6 py-4"><div class="flex items-center space-x-2 mb-2"><span class="text-sm font-medium text-gray-900">{{ comment.author.full_name|default:comment.author.email }}</span><span class="px-2 py-0.5 text-xs font-medium rounded-full {% if comment.author.is_admin %}bg-indigo-100 text-indigo-700{% else %}bg-sky-100 text-sky-700{% endif %}">{{ comment.author.get_role_display }}</span><span class="text-xs text-gray-400">{{ comment.created_at|date:'d/m/Y H:i' }}</span></div><p class="text-sm text-gray-600">{{ comment.content|linebreaksbr }}</p></div>{% empty %}<div class="px-6 py-8 text-center text-gray-500 text-sm">Nenhum comentário ainda. </div>{% endfor %}</div><div class="px-6 py-4 border-t border-gray-200 bg-gray-50"><form method="post" action="{% url 'tickets:detail' ticket.pk %}" class="space-y-3">{% csrf_token %} <div>{{ comment_form.content }}{% if comment_form.content.errors %}<p class="text-rose-600 text-xs mt-1">{{ comment_form.content.errors.0 }}</p>{% endif %} </div><div class="flex justify-end"><button type="submit" class="px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white text-sm font-medium rounded-lg shadow-sm hover:from-indigo-700 hover:to-purple-700 transition-all duration-200">Enviar Comentário</button></div></form></div></div></div><div class="space-y-6"><div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"><div class="px-6 py-4 border-b border-gray-200"><h2 class="text-sm font-semibold text-gray-900 uppercase tracking-wide">Informações</h2></div><div class="p-6 space-y-4"><div><p class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-1">Projeto</p><p class="text-sm font-bold text-indigo-700">{{ ticket.project.name|default:'—' }}</p></div>{% if ticket.attachment %}<div><p class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-1">Anexo</p><a href="{{ ticket.attachment.url }}" target="_blank" class="text-sm font-medium text-indigo-600 hover:text-indigo-800 transition-colors duration-200 flex items-center gap-1"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"></path></svg> Visualizar / Baixar</a></div>{% endif %}<div><p class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-1">Criado por</p><p class="text-sm text-gray-900">{{ ticket.created_by.full_name|default:ticket.created_by.email }}</p></div><div><p class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-1">Responsável</p><p class="text-sm text-gray-900">{{ ticket.assigned_agent.full_name|default:'Não atribuído' }} </p></div><div><p class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-1">Criado em</p><p class="text-sm text-gray-900">{{ ticket.created_at|date:'d/m/Y H:i' }}</p></div>{% if ticket.resolved_at %}<div><p class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-1">Resolvido em</p><p class="text-sm text-gray-900">{{ ticket.resolved_at|date:'d/m/Y H:i' }}</p></div>{% endif %}{% if ticket.closed_at %}<div><p class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-1">Fechado em</p><p class="text-sm text-gray-900">{{ ticket.closed_at|date:'d/m/Y H:i' }}</p></div>{% endif %} </div></div>{% if assign_form %}<div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"><div class="px-6 py-4 border-b border-gray-200"><h2 class="text-sm font-semibold text-gray-900 uppercase tracking-wide">Atribuição</h2></div><div class="p-6"><form method="post" action="{% url 'tickets:assign' ticket.pk %}" class="space-y-3">{% csrf_token %}<input type="hidden" name="assign_me" value="1"><button type="submit" class="w-full px-3 py-2 bg-indigo-600 text-white text-sm font-medium rounded-lg hover:bg-indigo-700 transition-colors duration-200">Atribuir a Mim</button></form><div class="border-t border-gray-200 mt-4 pt-4"><form method="post" action="{% url 'tickets:assign' ticket.pk %}" class="space-y-3">{% csrf_token %}<div><label class="block text-xs font-medium text-gray-500 uppercase tracking-wide mb-1">Responsável</label>{{ assign_form.assigned_agent }}</div><button type="submit" class="w-full px-3 py-2 bg-gray-800 text-white text-sm font-medium rounded-lg hover:bg-gray-900 transition-colors duration-200">Salvar Atribuição</button></form></div></div></div>{% endif %}{% if allowed_transitions %}<div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"><div class="px-6 py-4 border-b border-gray-200"><h2 class="text-sm font-semibold text-gray-900 uppercase tracking-wide">Ações</h2></div><div class="p-6"><form method="post" action="{% url 'tickets:transition' ticket.pk %}" class="space-y-3">{% csrf_token %}<div><label class="block text-xs font-medium text-gray-500 uppercase tracking-wide mb-1">Novo Status</label>{{ transition_form.new_status }}</div><div><label class="block text-xs font-medium text-gray-500 uppercase tracking-wide mb-1">Motivo</label>{{ transition_form.reason }}</div><button type="submit" class="w-full px-3 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white text-sm font-medium rounded-lg shadow-sm hover:from-indigo-700 hover:to-purple-700 transition-all duration-200">Alterar Status</button></form></div></div>{% endif %}<div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"><div class="px-6 py-4 border-b border-gray-200"><h2 class="text-sm font-semibold text-gray-900 uppercase tracking-wide">SLA</h2></div><div class="p-6 space-y-4"><div><p class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-1">Primeira Resposta (FRT)</p><div class="flex items-center space-x-2"><span class="text-sm font-semibold {% if sla.frt_breached %}text-rose-600{% elif sla.frt_pending %}text-amber-600{% else %}text-emerald-600{% endif %}">{{ sla.frt_display }}</span>{% if sla.frt_breached %}<span class="px-2 py-0.5 text-xs rounded-full bg-rose-100 text-rose-700">Estourado</span>{% elif sla.frt_pending %}<span class="px-2 py-0.5 text-xs rounded-full bg-amber-100 text-amber-700">Pendente</span>{% else %}<span class="px-2 py-0.5 text-xs rounded-full bg-emerald-100 text-emerald-700">Respondido</span>{% endif %}</div><p class="text-xs text-gray-400 mt-1">Meta: {{ sla.frt_target }}</p></div><div><p class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-1">Tempo de Resolução (RT)</p><div class="flex items-center space-x-2"><span class="text-sm font-semibold {% if sla.rt_breached %}text-rose-600{% elif sla.rt_pending %}text-amber-600{% else %}text-emerald-600{% endif %}">{{ sla.rt_display }}</span>{% if sla.rt_breached %}<span class="px-2 py-0.5 text-xs rounded-full bg-rose-100 text-rose-700">Estourado</span>{% elif sla.rt_pending %}<span class="px-2 py-0.5 text-xs rounded-full bg-amber-100 text-amber-700">Em andamento</span>{% else %}<span class="px-2 py-0.5 text-xs rounded-full bg-emerald-100 text-emerald-700">Resolvido</span>{% endif %}</div><p class="text-xs text-gray-400 mt-1">Meta: {{ sla.rt_target }}</p></div></div></div><div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"><div class="px-6 py-4 border-b border-gray-200"><h2 class="text-sm font-semibold text-gray-900 uppercase tracking-wide">Histórico</h2></div><div class="p-6">{% if audit_logs %}<div class="space-y-4">{% for log in audit_logs %}<div class="flex items-start space-x-3"><div class="flex-shrink-0 mt-1 w-2 h-2 rounded-full {% if log.new_status  ==  'CLOSED' %}bg-gray-400{% elif log.new_status  ==  'RESOLVED' %}bg-emerald-500{% elif log.new_status  ==  'IN_PROGRESS' %}bg-indigo-500{% else %}bg-amber-500{% endif %}"></div><div><p class="text-xs text-gray-900"><span class="font-medium">{{ log.changed_by_name }}</span> {% if log.old_status %}alterou de <span class="font-medium">{{ log.old_status }}</span> para {% endif %}<span class="font-medium">{{ log.new_status }}</span></p>{% if log.reason %}<p class="text-xs text-gray-500 mt-0.5">{{ log.reason }}</p>{% endif %}<p class="text-xs text-gray-400 mt-0.5">{{ log.created_at|date:'d/m/Y H:i' }}</p></div></div>{% endfor %}</div>{% else %}<p class="text-sm text-gray-500 text-center">Sem registros. </p>{% endif %}</div></div></div></div></div>{% endblock %}
